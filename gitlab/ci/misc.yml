check static codecov:
  extends: [.tiny_job]
  stage: ci_checks
  image: bash
  script:
    - wget https://codecov.io/bash -O newcodecov
    - diff newcodecov gitlab/uploadcodecov.sh

phpcs_compatibility:
  extends: [.tiny_job]
  stage: style
  image: pipelinecomponents/php-codesniffer:latest
  parallel:
    matrix:
      - PHPVERSION: ["7.4","8.1"]
  script:
    - phpcs --config-set installed_paths /app/vendor/phpcompatibility/php-compatibility
    - >
      phpcs -s -p --colors
      --standard=PHPCompatibility
      --extensions=php
      --runtime-set testVersion $PHPVERSION
      lib/lib.*.php
      etc
      judge
      webapp/src
      webapp/tests
      webapp/public
      webapp/config

# This finds different problems from codesniffer
php linter:
  extends: [.tiny_job]
  stage: style
  image: pipelinecomponents/php-linter:latest
  script:
    - >
      parallel-lint --colors
      lib/lib.*.php
      etc
      judge
      webapp/src
      webapp/tests
      webapp/public
      webapp/config

run chroot script checks:
  extends: [.normal_job]
  stage: chroot_checks
  when: manual
  allow_failure: true
  parallel:
    matrix:
      - PLACEHOLDER:
        - trigger_with_default_values
      - ARCH:
        - amd64
        - arm64
        - armhf
        - i386
  script:
    - ./gitlab/chroot_checks.sh

