# This placeholder job tries to start as soon as possible
.clean_ordering:
  needs: []
  retry:
    max: 2 #Max is 2, set when gitlab is flacky
    when:
      - always
  artifacts:
    when: always
    paths:
      - duration
  script:
    - /bin/true
  before_script:
    - set -eux
    - mkdir -p duration
    - LOG=$(echo $CI_JOB_NAME|base64)
    - echo "job_begin" $(date +%s) >> ./duration/$LOG
  after_script:
    - set -eux
    - LOG=$(echo $CI_JOB_NAME|base64)
    - echo "job_end" $(date +%s) >> ./duration/$LOG

.tiny_job:
  extends: [.clean_ordering]
  timeout: 4m

.short_job:
  extends: [.clean_ordering]
  timeout: 7m

.normal_job:
  extends: [.clean_ordering]
  timeout: 15m

.long_job:
  extends: [.clean_ordering]
  timeout: 30m

.mysql_job:
  script:
    - /bin/true
  services:
    - name: mysql
      command: ["--default-authentication-plugin=mysql_native_password"]
      alias: sqlserver

.mariadb_job:
  script:
    - /bin/true
  services:
    - name: mariadb
      alias: sqlserver

.phpsupported_job:
  script:
    - /bin/true
  parallel:
    matrix:
      - PHPVERSION: ["7.4","8.0","8.1"]
        TEST: ["E2E","Unit"]
        CRAWL_DATASOURCES: ["0","1","2"]
