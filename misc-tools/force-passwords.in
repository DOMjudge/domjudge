#!/usr/bin/python3

import subprocess

webappdir = '@domserver_webappdir@'
etcdir = '@domserver_etcdir@'

with open(f'{etcdir}/restapi.secret', 'r') as f:
    while True:
        line = f.readline()
        if line.startswith('#'):
            continue
        tokens = line.split()
        if len(tokens) == 4 and tokens[0] == 'default':
            user = tokens[2]
            password = tokens[3]
            subprocess.run([webappdir + '/bin/console', 'domjudge:reset-user-password', user, password])    
        break

with open(f'{etcdir}/initial_admin_password.secret', 'r') as f:
    password = f.readline().strip()
    subprocess.run([webappdir + '/bin/console', 'domjudge:reset-user-password', 'admin', password]) 
