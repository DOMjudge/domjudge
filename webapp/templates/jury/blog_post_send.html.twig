{% extends "jury/base.html.twig" %}

{% block title %}{{ action|capitalize }} a blog post - {{ parent() }}{% endblock %}

{% block extrahead %}
    {{ parent() }}
{% endblock %}

{% block content %}
    <style>
        .ce-block__content,
        .ce-toolbar__content {
            max-width: unset;
        }
    </style>
    <div class="container">
        <h1>{{ action|capitalize }} a blog post</h1>

        {{ form_start(form) }}

        {{ form_row(form.title) }}
        {{ form_row(form.subtitle) }}
        {{ form_row(form.thumbnail) }}
        {{ form_row(form.author) }}

        <label>Text</label>
        <div class="card mb-3">
            <div class="card-body">
                <div id="editorjs">

                </div>
            </div>
        </div>

        {{ form_row(form.publishtime) }}

        {{ form_row(form.send) }}

        {{ form_end(form) }}
    </div>

    {% if data is defined %}
        {{ data|raw }}
    {% endif %}

    <script src="{{ asset('js/editorjs/editorjs.js') }}"></script>
    <script src="{{ asset('js/editorjs/underline.js') }}"></script>
    <script src="{{ asset('js/editorjs/header.js') }}"></script>
    <script src="{{ asset('js/editorjs/list.js') }}"></script>
    <script src="{{ asset('js/editorjs/image.js') }}"></script>
    <script src="{{ asset('js/editorjs/inline-code.js') }}"></script>
    <script src="{{ asset('js/editorjs/code.js') }}"></script>
    <script src="{{ asset('js/editorjs/table.js') }}"></script>

    <script>
        const form = document.getElementsByName("blog_post")[0];
        const inputBody = document.getElementById("blog_post_body");

        const data = inputBody.value === "" ? null : JSON.parse(inputBody.value);

        const editor = new EditorJS({
            tools: {
                header: {
                    class: Header,
                    inlineToolbar: true
                },
                list: {
                    class: List,
                    inlineToolbar: true
                },
                underline: Underline,
                image: {
                    class: ImageTool,
                    config: {
                        endpoints: {
                            byFile: '{{ path('jury_blog_image_upload') }}',
                        }
                    },
                    inlineToolbar: true
                },
                inlineCode: InlineCode,
                code: CodeTool,
                table: Table,
            },
            data: data,
        })

        form.onsubmit = function (event) {
            event.preventDefault();

            editor.save().then((outputData) => {
                inputBody.value = JSON.stringify(outputData);
                form.submit();
            });
        }
    </script>
{% endblock %}
