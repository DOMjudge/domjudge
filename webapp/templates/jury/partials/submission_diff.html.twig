<div id="{{ editor_id }}-wrapper">
{# Mark the first tab that is shown as active. #}
{% set extra_css_classes = "active" %}
<ul class="nav nav-tabs source-tab-nav align-items-end">
    {%- for file in files %}
        {% set diff_id = "diff" ~ file.submitfileid %}
        <li class="nav-item">
            <a class="nav-link {{ extra_css_classes }}" data-bs-toggle="tab" data-rank="{{ file.rank }}" href="#{{ diff_id }}-tab" role="tab"><i class="fas fa-fw fa-file"></i> {{ file.filename }}</a>
        </li>
        {% set extra_css_classes = "" %}
    {%- endfor %}

            <div class="nav-item flex-grow-1 text-end mb-1">
                <a class="download btn btn-secondary btn-sm"
                   href="{{ path('jury_submission_source', {submission: submission.submitid, fetch: 0}) }}">
                    <i class="fas fa-download"></i> Download
                </a>
                {% if allowEdit %}
                    <a class="edit btn btn-secondary btn-sm"
                       href="{{ path('jury_submission_edit_source', {submission: submission.submitid, rank: 0}) }}">
                        <i class="fas fa-pencil-alt"></i> Edit
                    </a>
                {% endif %}
                <div class="btn-group">
                    <a href="#" role="button" class="btn btn-secondary btn-sm pe-none" aria-disabled="true"><i class="fas fa-code-branch"></i></a>
                    <select class="diff-select btn btn-secondary btn-sm form-select-sm text-start" aria-label="Submission to diff against">
                        <option value="">No diff</option>
                        {%- for other in otherSubmissions %}
                        <option value="{{ other.submitid }}">
                            {%- if originalSubmission and originalSubmission.submitid == other.submitid %}
                            s{{ other.submitid }} (original)
                            {%- elseif oldSubmission and oldSubmission.submitid == other.submitid %}
                            s{{ other.submitid }} (previous)
                            {%- else %}
                            s{{ other.submitid }}
                            {%- endif %}
                        </option>
                        {%- endfor %}
                    </select>
                </div>
                <div class="diff-mode btn-group">
                    <a href="#" role="button" class="btn btn-secondary btn-sm pe-none" aria-disabled="true"><i class="fas fa-plus-minus"></i></a>
                    {%- for mode_id, mode in diff_modes %}
                    <input type="radio" class="btn-check" name="{{ editor_id }}-mode" id="{{ editor_id }}-{{ mode_id }}" value="{{ mode_id }}" autocomplete="off">
                    <label class="btn btn-outline-secondary btn-sm" for="{{ editor_id }}-{{ mode_id }}">{{ mode.name }}</label>
                    {%- endfor %}
                </div>
            </div>
</ul>
<script>
$(() => {
    require(['vs/editor/editor.main'], () => {
        initDiffEditor('{{ editor_id }}');
    });
});
</script>
{% set extra_css_classes = "show active" %}
<div class="tab-content source-tab">
    {%- for file in files %}
        {% set diff_id = "diff" ~ file.submitfileid %}
        <div class="tab-pane fade {{ extra_css_classes }}" id="{{ diff_id }}-tab" role="tabpanel">
            {{ showDiff(editor_id, diff_id, file, otherFiles) }}
        </div>
        {% set extra_css_classes = "" %}
    {%- endfor %}
</div>
</div>
